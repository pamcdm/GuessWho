!function(){function e(e){var t;return 0===e.getUTCHours()?t=new Date(e.valueOf()):(t=new Date,t.setUTCDate(e.getDate()),t.setUTCMonth(e.getMonth()),t.setUTCFullYear(e.getFullYear()),t.setUTCHours(0)),t.setUTCMinutes(0),t.setUTCSeconds(0),t.setUTCMilliseconds(0),t}function t(e,t){e.appendChild(t)}function n(e){return parseInt(e,10)}function r(e){var t=n(e);return t===e&&!isNaN(t)&&t>=0&&6>=t}function o(e){return e instanceof Date&&!!e.getTime&&!isNaN(e.getTime())}function i(e){return e&&e.isArray?e.isArray():"[object Array]"===Object.prototype.toString.call(e)}function a(e){var t=e.split("."),n=t.shift(),r=document.createElement(n);return r[z]=t.join(" "),r}function s(){var e=document.documentElement,t={left:e.scrollLeft||document.body.scrollLeft||0,top:e.scrollTop||document.body.scrollTop||0,width:e.clientWidth,height:e.clientHeight};return t.right=t.left+t.width,t.bottom=t.top+t.height,t}function c(e){var t=e.getBoundingClientRect(),n=s(),r=n.left,o=n.top;return{left:t.left+r,right:t.right+r,top:t.top+o,bottom:t.bottom+o,width:t.width,height:t.height}}function u(e,t){xtag.addClass(e,t)}function l(e,t){xtag.removeClass(e,t)}function d(e,t){return xtag.hasClass(e,t)}function f(e){return e.getUTCFullYear()}function h(e){return e.getUTCMonth()}function p(e){return e.getUTCDate()}function v(e){return e.getUTCDay()}function m(e,t){var n=e.toString(),r=new Array(t).join("0");return(r+n).substr(-t)}function g(e){return[m(f(e),4),m(h(e)+1,2),m(p(e),2)].join("-")}function b(t){if(o(t))return t;var n=J.exec(t);return n?e(new Date(n[1],n[2]-1,n[3])):null}function _(t){if(o(t))return t;var n=b(t);if(n)return n;var r=Date.parse(t);return isNaN(r)?null:e(new Date(r))}function y(e){var t;if(i(e))t=e.slice(0);else{if(o(e))return[e];if(!("string"==typeof e&&e.length>0))return null;try{if(t=JSON.parse(e),!i(t))return console.warn("invalid list of ranges",e),null}catch(n){var r=_(e);return r?[r]:(console.warn("unable to parse",e,"as JSON or single date"),null)}}for(var a=0;a<t.length;a++){var s=t[a];if(!o(s))if("string"==typeof s){var c=_(s);if(!c)return console.warn("unable to parse date",s),null;t[a]=c}else{if(!i(s)||2!==s.length)return console.warn("invalid range value: ",s),null;var u=_(s[0]);if(!u)return console.warn("unable to parse start date",s[0],"from range",s),null;var l=_(s[1]);if(!l)return console.warn("unable to parse end date",s[1],"from range",s),null;if(u.valueOf()>l.valueOf())return console.warn("invalid range",s,": start date is after end date"),null;t[a]=[u,l]}}return t}function w(t,n,r,o){return void 0===n&&(n=f(t)),void 0===r&&(r=h(t)),void 0===o&&(o=p(t)),e(new Date(n,r,o))}function E(e,t,n,r){return w(e,f(e)+t,h(e)+n,p(e)+r)}function x(e,t){t=n(t),r(t)||(t=0);for(var o=0;7>o;o++){if(v(e)===t)return e;e=T(e)}throw"unable to find week start"}function O(e,t){t=n(t),r(t)||(t=6);for(var o=0;7>o;o++){if(v(e)===t)return e;e=A(e)}throw"unable to find week end"}function N(t){return t=new Date(t.valueOf()),t.setUTCDate(1),e(t)}function L(e){return T(E(e,0,1,0))}function A(e){return E(e,0,0,1)}function T(e){return E(e,0,0,-1)}function C(e,t){if(t){t=void 0===t.length?[t]:t;var n=!1;return t.forEach(function(t){2===t.length?k(t[0],t[1],e)&&(n=!0):g(t)===g(e)&&(n=!0)}),n}}function k(e,t,n){return g(e)<=g(n)&&g(n)<=g(t)}function M(e){e.sort(function(e,t){var n=o(e)?e:e[0],r=o(t)?t:t[0];return n.valueOf()-r.valueOf()})}function D(e){var n=a("div.controls"),r=a("span.prev"),o=a("span.next");return r.innerHTML=e.prev,o.innerHTML=e.next,t(n,r),t(n,o),n}function S(e){var t=this;e=e||{},t._span=e.span||1,t._multiple=e.multiple||!1,t._viewDate=t._sanitizeViewDate(e.view,e.chosen),t._chosenRanges=t._sanitizeChosenRanges(e.chosen,e.view),t._firstWeekdayNum=e.firstWeekdayNum||0,t._el=a("div.calendar"),t._labels=I(),t._customRenderFn=null,t._renderRecursionFlag=!1,t.render(!0)}function j(e){e=e.slice(0),M(e);for(var t=[],n=0;n<e.length;n++){var r,i,a,s,c=e[n],u=t.length>0?t[t.length-1]:null;if(o(c)?r=i=c:(r=c[0],i=c[1]),c=C(r,i)?r:[r,i],o(u))a=s=u;else{if(!u){t.push(c);continue}a=u[0],s=u[1]}if(C(r,[u])||C(T(r),[u])){var l=a.valueOf()<r.valueOf()?a:r,d=s.valueOf()>i.valueOf()?s:i,f=C(l,d)?l:[l,d];t[t.length-1]=f}else t.push(c)}return t}function R(e,t){var n,r=t.getAttribute("data-date"),o=_(r);d(t,Y)?(e.xtag.dragType=W,n="datetoggleoff"):(e.xtag.dragType=q,n="datetoggleon"),e.xtag.dragStartEl=t,e.xtag.dragAllowTap=!0,e.noToggle||xtag.fireEvent(e,n,{detail:{date:o,iso:r}}),e.setAttribute("active",!0),t.setAttribute("active",!0)}function U(e,t){var n=t.getAttribute("data-date"),r=_(n);t!==e.xtag.dragStartEl&&(e.xtag.dragAllowTap=!1),e.noToggle||(e.xtag.dragType!==q||d(t,Y)?e.xtag.dragType===W&&d(t,Y)&&xtag.fireEvent(e,"datetoggleoff",{detail:{date:r,iso:n}}):xtag.fireEvent(e,"datetoggleon",{detail:{date:r,iso:n}})),e.xtag.dragType&&t.setAttribute("active",!0)}function F(){for(var e=xtag.query(document,"x-calendar"),t=0;t<e.length;t++){var n=e[t];n.xtag.dragType=null,n.xtag.dragStartEl=null,n.xtag.dragAllowTap=!1,n.removeAttribute("active")}for(var r=xtag.query(document,"x-calendar .day[active]"),o=0;o<r.length;o++)r[o].removeAttribute("active")}function P(e,t,n){return n.left<=e&&e<=n.right&&n.top<=t&&t<=n.bottom}var H=0,I=function(){return{prev:"<",next:">",months:["January","February","March","April","May","June","July","August","September","October","November","December"],weekdays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"]}},V=e(new Date),q="add",W="remove",Y="chosen",z="className",J=/(\d{4})[^\d]?(\d{2})[^\d]?(\d{2})/,X=S.prototype;X.makeMonth=function(e){if(!o(e))throw"Invalid view date!";var n=this.firstWeekdayNum,r=this.chosen,i=this.labels,s=h(e),c=x(N(e),n),l=a("div.month"),d=a("div.month-label");d.textContent=i.months[s]+" "+f(e),t(l,d);for(var v=a("div.weekday-labels"),m=0;7>m;m++){var b=(n+m)%7,_=a("span.weekday-label");_.textContent=i.weekdays[b],t(v,_)}t(l,v);for(var y=a("div.week"),w=c,E=42,m=0;E>m;m++){var O=a("span.day");if(O.setAttribute("data-date",g(w)),O.textContent=p(w),h(w)!==s&&u(O,"badmonth"),C(w,r)&&u(O,Y),C(w,V)&&u(O,"today"),t(y,O),w=A(w),0===(m+1)%7){t(l,y),y=a("div.week");var L=h(w)>s||h(w)<s&&f(w)>f(c);if(L)break}}return l},X._sanitizeViewDate=function(e,t){t=void 0===t?this.chosen:t;var n;if(o(e))n=e;else if(o(t))n=t;else if(i(t)&&t.length>0){var r=t[0];n=o(r)?r:r[0]}else n=V;return n},X._sanitizeChosenRanges=function(e,t){t=void 0===t?this.view:t;var n;n=o(e)?[e]:i(e)?e:null!==e&&void 0!==e&&t?[t]:[];var r=j(n);if(!this.multiple&&r.length>0){var a=r[0];return o(a)?[a]:[a[0]]}return r},X.addDate=function(e,t){o(e)&&(t?(this.chosen.push(e),this.chosen=this.chosen):this.chosen=[e])},X.removeDate=function(e){if(o(e))for(var t=this.chosen.slice(0),n=0;n<t.length;n++){var r=t[n];if(C(e,[r])){if(t.splice(n,1),i(r)){var a=r[0],s=r[1],c=T(e),u=A(e);C(c,[r])&&t.push([a,c]),C(u,[r])&&t.push([u,s])}this.chosen=j(t);break}}},X.hasChosenDate=function(e){return C(e,this._chosenRanges)},X.hasVisibleDate=function(e,t){var n=t?this.firstVisibleMonth:this.firstVisibleDate,r=t?L(this.lastVisibleMonth):this.lastVisibleDate;return C(e,[[n,r]])},X.render=function(e){var n,r=this._span;if(e){var o,i=xtag.query(this.el,".day");for(n=0;n<i.length;n++)if(o=i[n],o.hasAttribute("data-date")){var a=o.getAttribute("data-date"),s=b(a);s&&(C(s,this._chosenRanges)?u(o,Y):l(o,Y),C(s,[V])?u(o,"today"):l(o,"today"))}}else{this.el.innerHTML="";var c=this.firstVisibleMonth;for(n=0;r>n;n++)t(this.el,this.makeMonth(c)),c=E(c,0,1,0)}this._callCustomRenderer()},X._callCustomRenderer=function(){if(this._customRenderFn){if(this._renderRecursionFlag)throw"Error: customRenderFn causes recursive loop of rendering calendar; make sure your custom rendering function doesn't modify attributes of the x-calendar that would require a re-render!";for(var e=xtag.query(this.el,".day"),t=0;t<e.length;t++){var n=e[t],r=n.getAttribute("data-date"),o=b(r);this._renderRecursionFlag=!0,this._customRenderFn(n,o?o:null,r),this._renderRecursionFlag=!1}}},Object.defineProperties(X,{el:{get:function(){return this._el}},multiple:{get:function(){return this._multiple},set:function(e){this._multiple=e,this.chosen=this._sanitizeChosenRanges(this.chosen),this.render(!0)}},span:{get:function(){return this._span},set:function(e){var t=n(e);this._span=!isNaN(t)&&t>=0?t:0,this.render(!1)}},view:{attribute:{},get:function(){return this._viewDate},set:function(e){var t=this._sanitizeViewDate(e),n=this._viewDate;this._viewDate=t,this.render(h(n)===h(t)&&f(n)===f(t))}},chosen:{get:function(){return this._chosenRanges},set:function(e){this._chosenRanges=this._sanitizeChosenRanges(e),this.render(!0)}},firstWeekdayNum:{get:function(){return this._firstWeekdayNum},set:function(e){e=n(e),r(e)||(e=0),this._firstWeekdayNum=e,this.render(!1)}},lastWeekdayNum:{get:function(){return(this._firstWeekdayNum+6)%7}},customRenderFn:{get:function(){return this._customRenderFn},set:function(e){this._customRenderFn=e,this.render(!0)}},chosenString:{get:function(){if(this.multiple){for(var e=this.chosen.slice(0),t=0;t<e.length;t++){var n=e[t];e[t]=o(n)?g(n):[g(n[0]),g(n[1])]}return JSON.stringify(e)}return this.chosen.length>0?g(this.chosen[0]):""}},firstVisibleMonth:{get:function(){return N(E(this.view,0,-Math.floor(this.span/2),0))}},lastVisibleMonth:{get:function(){return E(this.firstVisibleMonth,0,Math.max(0,this.span-1),0)}},firstVisibleDate:{get:function(){return x(this.firstVisibleMonth,this.firstWeekdayNum)}},lastVisibleDate:{get:function(){return O(L(this.lastVisibleMonth),this.lastWeekdayNum)}},labels:{get:function(){return this._labels},set:function(e){var t=this.labels;for(var n in t)if(n in e){var r=this._labels[n],o=e[n];if(i(r)){if(!i(o)||r.length!==o.length)throw"invalid label given for '"+n+"': expected array of "+r.length+" labels, got "+JSON.stringify(o);o=o.slice(0);for(var a=0;a<o.length;a++)o[a]=o[a].toString?o[a].toString():String(o[a])}else o=String(o);t[n]=o}this.render(!1)}}});var G=null,B=null;xtag.register("x-calendar",{lifecycle:{created:function(){this.innerHTML="";var e=this.getAttribute("chosen");this.xtag.calObj=new S({span:this.getAttribute("span"),view:_(this.getAttribute("view")),chosen:y(e),multiple:this.hasAttribute("multiple"),firstWeekdayNum:this.getAttribute("first-weekday-num")}),t(this,this.xtag.calObj.el),this.xtag.calControls=null,this.xtag.dragType=null,this.xtag.dragStartEl=null,this.xtag.dragAllowTap=!1},inserted:function(){G||(G=xtag.addEvent(document,"mouseup",F)),B||(B=xtag.addEvent(document,"touchend",F)),this.render(!1)},removed:function(){0===xtag.query(document,"x-calendar").length&&(G&&(xtag.removeEvent(document,"mouseup",G),G=null),B&&(xtag.removeEvent(document,"touchend",B),B=null))}},events:{"tap:delegate(.next)":function(e){var t=e.currentTarget;t.nextMonth(),xtag.fireEvent(t,"nextmonth")},"tap:delegate(.prev)":function(e){var t=e.currentTarget;t.prevMonth(),xtag.fireEvent(t,"prevmonth")},"tapstart:delegate(.day)":function(e){(e.touches||!e.button||e.button===H)&&(e.preventDefault(),e.baseEvent&&e.baseEvent.preventDefault(),R(e.currentTarget,this))},touchmove:function(e){if(e.touches&&e.touches.length>0){var t=e.currentTarget;if(t.xtag.dragType)for(var n=e.touches[0],r=xtag.query(t,".day"),o=0;o<r.length;o++){var i=r[o];P(n.pageX,n.pageY,c(i))?U(t,i):i.removeAttribute("active")}}},"mouseover:delegate(.day)":function(e){var t=e.currentTarget,n=this;U(t,n)},"mouseout:delegate(.day)":function(){var e=this;e.removeAttribute("active")},"tapend:delegate(.day)":function(e){var t=e.currentTarget;if(t.xtag.dragAllowTap){var n=this,r=n.getAttribute("data-date"),o=_(r);xtag.fireEvent(t,"datetap",{detail:{date:o,iso:r}})}},datetoggleon:function(e){var t=this;t.toggleDateOn(e.detail.date,t.multiple)},datetoggleoff:function(e){var t=this;t.toggleDateOff(e.detail.date)}},accessors:{controls:{attribute:{"boolean":!0},set:function(e){e&&!this.xtag.calControls&&(this.xtag.calControls=D(this.xtag.calObj.labels),t(this,this.xtag.calControls))}},multiple:{attribute:{"boolean":!0},get:function(){return this.xtag.calObj.multiple},set:function(e){this.xtag.calObj.multiple=e,this.chosen=this.chosen}},span:{attribute:{},get:function(){return this.xtag.calObj.span},set:function(e){this.xtag.calObj.span=e}},view:{attribute:{},get:function(){return this.xtag.calObj.view},set:function(e){var t=_(e);t&&(this.xtag.calObj.view=t)}},chosen:{attribute:{skip:!0},get:function(){var e=this.xtag.calObj.chosen;if(this.multiple)return this.xtag.calObj.chosen;if(e.length>0){var t=e[0];return o(t)?t:t[0]}return null},set:function(e){var t=this.multiple?y(e):_(e);this.xtag.calObj.chosen=t?t:null,this.xtag.calObj.chosenString?this.setAttribute("chosen",this.xtag.calObj.chosenString):this.removeAttribute("chosen")}},firstWeekdayNum:{attribute:{name:"first-weekday-num"},set:function(e){this.xtag.calObj.firstWeekdayNum=e}},noToggle:{attribute:{"boolean":!0,name:"notoggle"},set:function(e){e&&(this.chosen=null)}},firstVisibleMonth:{get:function(){return this.xtag.calObj.firstVisibleMonth}},lastVisibleMonth:{get:function(){return this.xtag.calObj.lastVisibleMonth}},firstVisibleDate:{get:function(){return this.xtag.calObj.firstVisibleDate}},lastVisibleDate:{get:function(){return this.xtag.calObj.lastVisibleDate}},customRenderFn:{get:function(){return this.xtag.calObj.customRenderFn},set:function(e){this.xtag.calObj.customRenderFn=e}},labels:{get:function(){return JSON.parse(JSON.stringify(this.xtag.calObj.labels))},set:function(e){this.xtag.calObj.labels=e;var t=this.xtag.calObj.labels,n=this.querySelector(".controls > .prev");n&&(n.textContent=t.prev);var r=this.querySelector(".controls > .next");r&&(r.textContent=t.next)}}},methods:{render:function(e){this.xtag.calObj.render(e)},prevMonth:function(){var e=this.xtag.calObj;e.view=E(e.view,0,-1,0)},nextMonth:function(){var e=this.xtag.calObj;e.view=E(e.view,0,1,0)},toggleDateOn:function(e,t){this.xtag.calObj.addDate(e,t),this.chosen=this.chosen},toggleDateOff:function(e){this.xtag.calObj.removeDate(e),this.chosen=this.chosen},toggleDate:function(e,t){this.xtag.calObj.hasChosenDate(e)?this.toggleDateOff(e):this.toggleDateOn(e,t)},hasVisibleDate:function(e,t){return this.xtag.calObj.hasVisibleDate(e,t)}}})}();